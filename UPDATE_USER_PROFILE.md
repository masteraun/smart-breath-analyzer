# 📝 การอัปเดตระบบ - User Profile & History

## 🎯 สิ่งที่เพิ่มเติม

### 1. 📋 ระบบลงทะเบียนแบบเต็มรูปแบบ

#### Login (เดิม)
- Username
- Password

#### Register (ใหม่) ✨
- **ชื่อ** (First Name)
- **นามสกุล** (Last Name)
- **วันเดือนปีเกิด** (Birth Date)
- Username
- Password

---

### 2. 👤 หน้า User Profile (`user.html`)

แสดงข้อมูล:
- 👤 **ชื่อ - นามสกุล** (บรรทัดที่ 1)
- 📅 **วันเดือนปีเกิด** (บรรทัดที่ 2) - แสดงเป็นภาษาไทย
- 📋 **ประวัติการตรวจ** (บรรทัดที่ 3)

#### ตารางประวัติการตรวจ:

| ครั้งที่ | วันที่ | เวลา | อาการที่ตรวจพบ |
|---------|--------|------|----------------|
| 1 | 14/02/2026 | 14:30:25 | Status: Normal |
| 2 | 14/02/2026 | 15:45:10 | Risk: Alcohol |

**Features:**
- แสดงประวัติจากใหม่ไปเก่า
- สีของ badge เปลี่ยนตามระดับความเสี่ยง:
  - 🟢 **Normal** - เขียว
  - 🟡 **Caution** - เหลือง
  - 🔴 **Risk** - แดง
- ปุ่ม **"กลับหน้าหลัก"** ไปยัง `/intro`

---

### 3. 🔗 ลิงก์ User Profile

**ทุกหน้า** (ยกเว้น login) สามารถคลิกที่ **👤 username** มุมขวาบนเพื่อเข้าสู่หน้า User Profile

หน้าที่อัปเดต:
- ✅ `intro.html`
- ✅ `index.html` (Dashboard)
- ✅ `page2.html`
- ✅ `end.html`

**Hover Effect:** เมื่อเอาเมาส์ไปชี้ที่ username จะมี animation

---

### 4. 💾 ระบบบันทึกประวัติการตรวจ

#### การทำงาน:
1. เมื่อผู้ใช้เสร็จสิ้นการวัดและเข้าสู่หน้า **Page2**
2. ระบบจะ**อัตโนมัติ**บันทึกผลการประเมินความเสี่ยง
3. บันทึกลงไฟล์ `history.json`
4. สามารถดูได้ที่หน้า User Profile

#### ข้อมูลที่บันทึก:
```json
{
  "username": [
    {
      "date": "14/02/2026",
      "time": "14:30:25",
      "assessment": "Status: Normal",
      "timestamp": "2026-02-14T14:30:25"
    }
  ]
}
```

---

## 📂 ไฟล์ที่เปลี่ยนแปลง

### 1. `app.py` - Backend
**เพิ่ม:**
- ฟังก์ชัน `load_history()` - โหลดประวัติการตรวจ
- ฟังก์ชัน `save_history()` - บันทึกประวัติ
- ฟังก์ชัน `add_history_record()` - เพิ่มประวัติใหม่
- ฟังก์ชัน `thai_date()` - แปลงวันที่เป็นภาษาไทย
- Route `/api/save_assessment` - API บันทึกผลการตรวจ
- ปรับปรุง `/login` route - รองรับข้อมูลส่วนตัว
- ปรับปรุง `/user` route - แสดงประวัติการตรวจ

**รองรับทั้ง:**
- User แบบเก่า: `{"username": "password"}`
- User แบบใหม่: `{"username": {"password": "...", "firstname": "..."}}`

---

### 2. `templates/login.html`
**เพิ่ม:**
- ช่องกรอก: ชื่อ, นามสกุล, วันเดือนปีเกิด (แสดงเฉพาะตอน Register)
- Toggle แสดง/ซ่อนช่องเพิ่มเติม
- ส่งข้อมูลแบบเต็มรูปแบบไปยัง Backend

---

### 3. `templates/user.html` (ใหม่)
**สร้างใหม่ทั้งหมด:**
- แสดงข้อมูลส่วนตัว
- ตารางประวัติการตรวจ
- Badge สีตามระดับความเสี่ยง
- Responsive design
- Snowflake animation

---

### 4. `templates/intro.html`
**เพิ่ม:**
- ลิงก์ไปยัง User Profile ที่ username
- Hover effect

---

### 5. `templates/index.html`
**เพิ่ม:**
- ลิงก์ไปยัง User Profile ที่ username
- Hover effect

---

### 6. `templates/page2.html`
**เพิ่ม:**
- ลิงก์ไปยัง User Profile ที่ username
- Hover effect
- **ฟังก์ชัน `saveAssessmentToHistory()`** - บันทึกผลการตรวจอัตโนมัติ
- Auto-save เมื่อโหลดหน้า

---

### 7. `templates/end.html`
**เพิ่ม:**
- ลิงก์ไปยัง User Profile ที่ username
- Hover effect

---

## 🗂️ ไฟล์ข้อมูลใหม่

### `users.json`
```json
{
  "admin": {
    "password": "1234",
    "firstname": "Admin",
    "lastname": "System",
    "birthdate": "2000-01-01"
  },
  "john": {
    "password": "pass123",
    "firstname": "John",
    "lastname": "Doe",
    "birthdate": "1995-05-15"
  }
}
```

### `history.json`
```json
{
  "admin": [
    {
      "date": "14/02/2026",
      "time": "14:30:25",
      "assessment": "Status: Normal",
      "timestamp": "2026-02-14T14:30:25"
    },
    {
      "date": "14/02/2026",
      "time": "15:45:10",
      "assessment": "Risk: Alcohol",
      "timestamp": "2026-02-14T15:45:10"
    }
  ]
}
```

---

## 🚀 การใช้งาน

### 1. Register User ใหม่

1. ไปที่หน้า Login
2. คลิก **"ลงทะเบียนใหม่"**
3. กรอกข้อมูล:
   - ชื่อ: `สมชาย`
   - นามสกุล: `ใจดี`
   - วันเดือนปีเกิด: `1995-05-15`
   - Username: `somchai`
   - Password: `pass123`
4. คลิก **"สมัครสมาชิก"**
5. Login ด้วย username และ password ที่สร้าง

---

### 2. ดูข้อมูล User Profile

1. Login เข้าระบบ
2. คลิกที่ **👤 username** มุมขวาบน (จากหน้าใดก็ได้)
3. จะเห็น:
   - ชื่อ-นามสกุล
   - วันเดือนปีเกิด (ภาษาไทย)
   - ประวัติการตรวจทั้งหมด

---

### 3. บันทึกประวัติการตรวจ

**อัตโนมัติ!** เมื่อ:
1. ทำการวัดที่ Dashboard
2. ไปที่หน้า Page2 (วิเคราะห์ผล)
3. ระบบจะบันทึกผลการประเมินความเสี่ยงโดยอัตโนมัติ
4. สามารถดูได้ที่หน้า User Profile

---

## 🎨 ตัวอย่างหน้าจอ

### หน้า Register
```
        📝
    สมัครสมาชิก

ชื่อ (First Name)
[กรอกชื่อจริง]

นามสกุล (Last Name)
[กรอกนามสกุล]

วันเดือนปีเกิด (Birth Date)
[📅 1995-05-15]

ชื่อผู้ใช้งาน (Username)
[กรอกชื่อผู้ใช้งาน]

รหัสผ่าน (Password)
[กรอกรหัสผ่าน]

[สมัครสมาชิก]

มีบัญชีอยู่แล้ว? เข้าสู่ระบบ
```

---

### หน้า User Profile
```
        👤
    สมชาย ใจดี
📅 วันเกิด: 15 พฤษภาคม 2538

📋 ประวัติการตรวจ

┌─────────┬────────────┬──────────┬──────────────────┐
│ ครั้งที่ │   วันที่   │  เวลา    │ อาการที่ตรวจพบ  │
├─────────┼────────────┼──────────┼──────────────────┤
│   3     │ 14/02/2026 │ 16:20:30 │ Risk: Alcohol    │
│   2     │ 14/02/2026 │ 15:45:10 │ Caution: Smoke   │
│   1     │ 14/02/2026 │ 14:30:25 │ Status: Normal   │
└─────────┴────────────┴──────────┴──────────────────┘

        [🏠 กลับหน้าหลัก]
```

---

## ✅ สรุปการอัปเดต

### ✨ Features ใหม่:
1. ✅ Register แบบเต็มรูปแบบ (ชื่อ, นามสกุล, วันเกิด)
2. ✅ หน้า User Profile พร้อมข้อมูลส่วนตัว
3. ✅ ระบบบันทึกประวัติการตรวจ
4. ✅ คลิก username เข้าสู่ User Profile ได้
5. ✅ แสดงวันเกิดเป็นภาษาไทย
6. ✅ ตารางประวัติการตรวจแบบสวยงาม
7. ✅ Badge สีตามระดับความเสี่ยง
8. ✅ Auto-save ผลการตรวจ

### 🔄 Backward Compatible:
- ✅ รองรับ User แบบเก่า (username/password อย่างเดียว)
- ✅ ไม่กระทบระบบเดิม
- ✅ Default user: `admin` / `1234` ยังใช้ได้

---

© 2026 Smart Breath Analyzer Project
